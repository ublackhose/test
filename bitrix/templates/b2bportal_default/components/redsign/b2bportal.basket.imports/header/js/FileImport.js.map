{"version":3,"file":"FileImport.js","sources":["../src/api.js","../src/FileImport.vue?rollup-plugin-vue=script.js","../../../../../../../../node_modules/vue-runtime-helpers/dist/normalize-component.js","../src/FileImport.vue","../src/FileImport.js"],"sourcesContent":["export async function action(actionName, data)\r\n{\r\n\tvar resultData = undefined;\r\n\r\n\ttry\r\n\t{\r\n\t\tconst result = await new Promise((resolve, reject) => {\r\n\t\t\tBX.ajax.runComponentAction(\r\n\t\t\t\t'redsign:b2bportal.basket.imports',\r\n\t\t\t\tactionName,\r\n\t\t\t\t{ \r\n\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t}\r\n\t\t\t).then(resolve, reject);\r\n\t\t});\r\n\r\n\t\tresultData = result.data;\r\n\t}\r\n\tcatch (e)\r\n\t{\r\n\t\tglobal.toastr.error(((e.errors || [])[0] || {}).message);\r\n\t\tthrow e;\r\n\t}\r\n\r\n\treturn resultData;\r\n};\r\n\r\nexport async function checkExistsCodes(data)\r\n{\r\n\treturn action('check', data);\r\n}\r\n\r\nexport async function addtobasket(data)\r\n{\r\n\treturn action('addtobasket', data)\r\n\t\t.then((result) => {\r\n\t\t\tBX.onCustomEvent('updateBasketComponent');\r\n\r\n\t\t\treturn result;\r\n\t\t});\r\n}\r\n\r\n\r\nexport async function parseFile(data)\r\n{\r\n\treturn action('parseFile', data);\r\n}","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { parseFile, addtobasket} from './api.js';\r\n\r\nexport default {\r\n\r\n\tcomponents: {\r\n\t\tStepper: B2BPortal.Vue.Components.Stepper\r\n\t},\r\n\r\n\tprops: {\r\n\t\tsignedParameters: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t}\r\n\t},\r\n\r\n\tdata()\r\n\t{\r\n\t\treturn {\r\n\t\t\tcurrentStepIndex: 0,\r\n\t\t\tsteps: Object.freeze([\r\n\t\t\t\t'step1',\r\n\t\t\t\t'step2',\r\n\t\t\t\t'step3'\r\n\t\t\t]),\r\n\t\t\tmethod: 'upload',\r\n\t\t\tfile: '',\r\n\t\t\tfilePath: '',\r\n\t\t\tfileRows: [],\r\n\t\t\tskipFirstRow: true,\r\n\t\t\tsettings: {\r\n\t\t\t\tcodeIndex: undefined,\r\n\t\t\t\tquantityIndex: undefined\r\n\t\t\t},\r\n\t\t\tresult: {}\r\n\t\t}\r\n\t},\r\n\r\n\tcomputed: {\r\n\r\n\t\tfileData()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\thighestColumn: this.fileRows.reduce((highest, row) => Math.max(highest, row.length), 0)\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tmessages()\r\n\t\t{\r\n\t\t\treturn (\r\n\t\t\t\tObject.freeze(\r\n\t\t\t\t\tObject.keys(BX.message).filter(message => message.startsWith('RS_B2BPORTAL_BI'))\r\n\t\t\t\t\t\t.reduce((obj, message) => { obj[message.slice(message)] = BX.message(message); return obj; }, {})\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t},\r\n\t},\r\n\r\n\tmethods: {\r\n\t\treset()\r\n\t\t{\r\n\t\t\tthis.currentStepIndex = 0;\r\n\t\t\tthis.fileRows = [];\r\n\t\t\tthis.file = '';\r\n\t\t\tthis.filePath = '';\r\n\r\n\t\t\tthis.settings = {\r\n\t\t\t\tcodeIndex: undefined,\r\n\t\t\t\tquantityIndex: undefined\r\n\t\t\t}\r\n\r\n\t\t\tthis.result = {};\r\n\t\t},\r\n\r\n\t\tstartLoader()\r\n\t\t{\r\n\t\t\tthis.$emit('startLoader')\r\n\t\t},\r\n\r\n\t\tendLoader()\r\n\t\t{\r\n\t\t\tthis.$emit('endLoader')\r\n\t\t},\r\n\r\n\t\tvalidateFileInput()\r\n\t\t{\r\n\t\t\tconst fileInput = this.$refs.fileInput;\r\n\t\t\tconst file = (fileInput.files || [])[0];\r\n\r\n\t\t\tthis.filePath = fileInput.value;\r\n\r\n\t\t\tif (file)\r\n\t\t\t{\r\n\t\t\t\tfileInput.classList.remove('is-invalid');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfileInput.classList.add('is-invalid');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thandleStep(step)\r\n\t\t{\r\n\t\t\tthis.currentStepIndex = step.index;\r\n\t\t},\r\n\r\n\t\tasync next(step)\r\n\t\t{\r\n\t\t\tswitch(step.name)\r\n\t\t\t{\r\n\t\t\t\tcase 'step1':\r\n\r\n\t\t\t\t\ttry \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.startLoader();\r\n\r\n\t\t\t\t\t\tif (await this.processReadFile())\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tstep.next();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e) {}\r\n\t\t\t\t\tfinally\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.endLoader();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'step2':\r\n\r\n\t\t\t\t\ttry \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.startLoader();\r\n\t\t\t\t\t\tstep.next();\r\n\t\t\t\t\t\tawait this.addtobasket();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e) {}\r\n\t\t\t\t\tfinally\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.endLoader();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync back(step)\r\n\t\t{\r\n\t\t\tstep.back();\r\n\t\t},\r\n\r\n\t\tasync processReadFile()\r\n\t\t{\r\n\t\t\tif (this.method === 'upload')\r\n\t\t\t{\r\n\t\t\t\treturn this.processReadFileByUpload();\r\n\t\t\t}\r\n\t\t\telse if (this.method === 'link')\r\n\t\t\t{\r\n\t\t\t\treturn this.processReadFileByPath();\r\n\t\t\t}\r\n\r\n\t\t\tthrow new Error('Wrong file upload method');\r\n\t\t},\r\n\r\n\t\tasync processReadFileByUpload()\r\n\t\t{\r\n\t\t\tconst fileInput = this.$refs.fileInput;\r\n\t\t\tconst file = (fileInput.files || [])[0];\r\n\r\n\t\t\tif (file)\r\n\t\t\t{\r\n\t\t\t\tconst formData = new FormData();\r\n\t\t\t\tformData.append('file', file);\r\n\t\t\t\tformData.append('signedParamaters', this.signedParameters);\r\n\t\t\t\tformData.append('sessid', BX.bitrix_sessid());\r\n\r\n\t\t\t\tthis.fileRows = await parseFile(formData);\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfileInput.classList.add('is-invalid');\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tasync processReadFileByPath()\r\n\t\t{\r\n\t\t\tthis.fileRows = await parseFile({\r\n\t\t\t\tpath: this.filePath,\r\n\t\t\t\tsignedParameters: this.signedParameters\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tprepareData()\r\n\t\t{\r\n\t\t\tlet data = {};\r\n\t\t\tconst rows=  [...this.fileRows];\r\n\r\n\t\t\tif (this.skipFirstRow)\r\n\t\t\t{\r\n\t\t\t\trows.shift();\r\n\t\t\t}\r\n\r\n\t\t\tfor (const row of rows)\r\n\t\t\t{\r\n\t\t\t\tconst codeStr = new String(row[this.settings.codeIndex - 1]);\r\n\t\t\t\tif (codeStr.trim() !== '')\r\n\t\t\t\t{\r\n\t\t\t\t\tdata[codeStr] = row[this.settings.quantityIndex - 1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\tasync addtobasket()\r\n\t\t{\r\n\t\t\tif (this.fileRows.length === 0)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst data = this.prepareData();\r\n\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tconst result = await addtobasket({\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tsignedParameters: this.signedParameters\t\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tthis.result = result;\r\n\t\t\t\tthis.$store.dispatch('cart/fetch');\r\n\t\t\t}\r\n\t\t\tcatch(e)\r\n\t\t\t{\r\n\t\t\t\tconsole.error(123);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\twatch: {\r\n\t\tfileRows(newVal)\r\n\t\t{\r\n\t\t\tif (this.fileRows.length > 0)\r\n\t\t\t{\r\n\t\t\t\tif ( this.fileRows[0].length === 5)\r\n\t\t\t\t{\r\n\t\t\t\t\t// default export\r\n\t\t\t\t\tthis.settings.codeIndex = 2;\r\n\t\t\t\t\tthis.settings.quantityIndex = 4;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.settings.codeIndex = this.fileRows[0].length > 0 ? 1 : undefined\r\n\t\t\t\t\tthis.settings.quantityIndex = this.fileRows[0].length > 1 ? 2 : undefined\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n} \r\n","'use strict';\n\nfunction normalizeComponent(template, style, script, scopeId, isFunctionalTemplate, moduleIdentifier\n/* server only */\n, shadowMode, createInjector, createInjectorSSR, createInjectorShadow) {\n  if (typeof shadowMode !== 'boolean') {\n    createInjectorSSR = createInjector;\n    createInjector = shadowMode;\n    shadowMode = false;\n  } // Vue.extend constructor export interop.\n\n\n  var options = typeof script === 'function' ? script.options : script; // render functions\n\n  if (template && template.render) {\n    options.render = template.render;\n    options.staticRenderFns = template.staticRenderFns;\n    options._compiled = true; // functional template\n\n    if (isFunctionalTemplate) {\n      options.functional = true;\n    }\n  } // scopedId\n\n\n  if (scopeId) {\n    options._scopeId = scopeId;\n  }\n\n  var hook;\n\n  if (moduleIdentifier) {\n    // server build\n    hook = function hook(context) {\n      // 2.3 injection\n      context = context || // cached call\n      this.$vnode && this.$vnode.ssrContext || // stateful\n      this.parent && this.parent.$vnode && this.parent.$vnode.ssrContext; // functional\n      // 2.2 with runInNewContext: true\n\n      if (!context && typeof __VUE_SSR_CONTEXT__ !== 'undefined') {\n        context = __VUE_SSR_CONTEXT__;\n      } // inject component styles\n\n\n      if (style) {\n        style.call(this, createInjectorSSR(context));\n      } // register component module identifier for async chunk inference\n\n\n      if (context && context._registeredComponents) {\n        context._registeredComponents.add(moduleIdentifier);\n      }\n    }; // used by ssr in case component is cached and beforeCreate\n    // never gets called\n\n\n    options._ssrRegister = hook;\n  } else if (style) {\n    hook = shadowMode ? function () {\n      style.call(this, createInjectorShadow(this.$root.$options.shadowRoot));\n    } : function (context) {\n      style.call(this, createInjector(context));\n    };\n  }\n\n  if (hook) {\n    if (options.functional) {\n      // register for functional component in vue file\n      var originalRender = options.render;\n\n      options.render = function renderWithStyleInjection(h, context) {\n        hook.call(context);\n        return originalRender(h, context);\n      };\n    } else {\n      // inject component registration as beforeCreate hook\n      var existing = options.beforeCreate;\n      options.beforeCreate = existing ? [].concat(existing, hook) : [hook];\n    }\n  }\n\n  return script;\n}\n\nmodule.exports = normalizeComponent;\n//# sourceMappingURL=normalize-component.js.map\n","<template>\r\n\r\n\t<Stepper :steps=\"steps\" :currentStep=\"currentStepIndex\" @onStep=\"handleStep\">\r\n\r\n\t\t<template v-slot:step1=\"step\">\r\n\r\n\t\t\t<div class=\"form-group\">\r\n\r\n\t\t\t\t{{messages.RS_B2BPORTAL_BI_FILE_IMPORT_STEP_1 }}<br><br>\r\n\t\t\t\t<ul class=\"nav nav-pills mb-3\">\r\n\t\t\t\t\t<li class=\"nav-item\">\r\n\t\t\t\t\t\t<a \r\n\t\t\t\t\t\t\tclass=\"nav-link\"\r\n\t\t\t\t\t\t\t:class=\"{active: method === 'upload'}\"  \r\n\t\t\t\t\t\t\thref=\"#\" \r\n\t\t\t\t\t\t\trole=\"tab\"\r\n\t\t\t\t\t\t\t@click.prevent=\"method = 'upload'\">\r\n\t\t\t\t\t\t\t{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_UPLOAD }}\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t<li class=\"nav-item\">\r\n\t\t\t\t\t\t<a \r\n\t\t\t\t\t\t\tclass=\"nav-link\" \r\n\t\t\t\t\t\t\t:class=\"{active: method === 'link'}\" \r\n\t\t\t\t\t\t\thref=\"#\" \r\n\t\t\t\t\t\t\t@click.prevent=\"method = 'link'\">\r\n\t\t\t\t\t\t\t{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_LINK}}\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</li>\r\n\t\t\t\t</ul>\r\n\r\n\t\t\t\t<transition name=\"fade\">\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<div v-show=\"method === 'upload'\">\r\n\t\t\t\t\t\t\t<label>{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_SELECT_FILE }}</label>\r\n\t\t\t\t\t\t\t<div></div>\r\n\t\t\t\t\t\t\t<div class=\"custom-file\">\r\n\t\t\t\t\t\t\t\t<input type=\"file\" class=\"custom-file-input\" ref=\"fileInput\" @change.prevent=\"validateFileInput\">\r\n\t\t\t\t\t\t\t\t<label class=\"custom-file-label\" for=\"customFile\" :data-browse=\"messages.RS_B2BPORTAL_BI_BROWSE\">{{ filePath }}</label>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div v-show=\"method === 'link'\">\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div class=\"form-group\">\r\n\t\t\t\t\t\t\t\t<label> {{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_DOCUMENT_LINK }} </label>\r\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" placeholder=\"https://example.com/file.csv\" v-model=\"filePath\">\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</transition>\r\n\t\t\t</div>\r\n\r\n\t\t\t<a class=\"btn btn-primary pull-right\" @click.prevent.stop=\"next(step)\" href=\"#\"> {{messages.RS_B2BPORTAL_BI_FILE_IMPORT_NEXT}} </a>\r\n\t\t</template>\r\n\r\n\t\t<template v-slot:step2=\"step\">\r\n\t\t\t{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_STEP_2 }}<br><br>\r\n\r\n\t\t\t<div class=\"form-group row\">\r\n\t\t\t\t<label for=\"example-input-2\" class=\"col-2 col-form-label\">{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_ARTICLE }}</label>\r\n\t\t\t\t<div class=\"col-10\">\r\n\t\t\t\t\t<select class=\"form-control\" id=\"example-input-2\" v-model=\"settings.codeIndex\">\r\n\t\t\t\t\t\t<option :value=\"undefined\">-</option>\r\n\t\t\t\t\t\t<option v-for=\"i in fileData.highestColumn\" :key=\"i\" :value=\"i\" :disabled=\"i === settings.quantityIndex\">{{ i }} ({{ fileRows[0][i - 1] }})</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"form-group row\">\r\n\t\t\t\t<label for=\"example-input-2\" class=\"col-2 col-form-label\">{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_QUANTITY }}</label>\r\n\t\t\t\t<div class=\"col-10\">\r\n\t\t\t\t\t<select class=\"form-control\" id=\"example-input-2\" v-model=\"settings.quantityIndex\">\r\n\t\t\t\t\t\t<option :value=\"undefined\">-</option>\r\n\t\t\t\t\t\t<option v-for=\"i in fileData.highestColumn\" :key=\"i\"  :value=\"i\" :disabled=\"i === settings.codeIndex\">{{ i }} ({{ fileRows[0][i - 1] }})</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"form-group row\">\r\n\t\t\t\t<div class=\"col-10 offset-2\">\r\n\t\t\t\t\t<label class=\"kt-checkbox\">\r\n\t\t\t\t\t\t<input type=\"checkbox\" v-model=\"skipFirstRow\"> {{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_SKIP_FIRST_ROW }}\r\n\t\t\t\t\t\t<span></span>\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<a class=\"btn btn-primary pull-right\" @click.prevent.stop=\"next(step)\" href=\"#\"> {{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_NEXT }} </a>\r\n\t\t\t<a class=\"btn btn-btn-outline-brand pull-right\" @click.prevent.stop=\"back(step)\" href=\"#\">{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_BACK }}</a>\r\n\t\t</template>\r\n\r\n\t\t<template v-slot:step3=\"step3\">\r\n\t\t\t{{ messages.RS_B2BPORTAL_BI_FILE_IMPORT_STEP_3 }}<br><br>\r\n\r\n\t\t\t<div v-if=\"!!result\">\r\n\t\t\t\t<div v-for=\"(basketResult, code) in result\" :key=\"code\">\r\n\t\t\t\t\t<span :class=\"{'text-success': basketResult.isSuccess, 'text-danger': !basketResult.isSuccess}\">{{code}}: {{ basketResult.message }} </span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<br><br>\r\n\r\n\t\t\t<a class=\"btn btn-primary pull-right\" @click.prevent.stop=\"reset()\" href=\"#\"> {{messages.RS_B2BPORTAL_BI_FILE_IMPORT_RESET}} </a>\r\n\t\t</template>\r\n\r\n\t</Stepper>\r\n\r\n</template>\r\n\r\n<script>\r\nimport { parseFile, addtobasket} from './api.js';\r\n\r\nexport default {\r\n\r\n\tcomponents: {\r\n\t\tStepper: B2BPortal.Vue.Components.Stepper\r\n\t},\r\n\r\n\tprops: {\r\n\t\tsignedParameters: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t}\r\n\t},\r\n\r\n\tdata()\r\n\t{\r\n\t\treturn {\r\n\t\t\tcurrentStepIndex: 0,\r\n\t\t\tsteps: Object.freeze([\r\n\t\t\t\t'step1',\r\n\t\t\t\t'step2',\r\n\t\t\t\t'step3'\r\n\t\t\t]),\r\n\t\t\tmethod: 'upload',\r\n\t\t\tfile: '',\r\n\t\t\tfilePath: '',\r\n\t\t\tfileRows: [],\r\n\t\t\tskipFirstRow: true,\r\n\t\t\tsettings: {\r\n\t\t\t\tcodeIndex: undefined,\r\n\t\t\t\tquantityIndex: undefined\r\n\t\t\t},\r\n\t\t\tresult: {}\r\n\t\t}\r\n\t},\r\n\r\n\tcomputed: {\r\n\r\n\t\tfileData()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\thighestColumn: this.fileRows.reduce((highest, row) => Math.max(highest, row.length), 0)\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tmessages()\r\n\t\t{\r\n\t\t\treturn (\r\n\t\t\t\tObject.freeze(\r\n\t\t\t\t\tObject.keys(BX.message).filter(message => message.startsWith('RS_B2BPORTAL_BI'))\r\n\t\t\t\t\t\t.reduce((obj, message) => { obj[message.slice(message)] = BX.message(message); return obj; }, {})\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t},\r\n\t},\r\n\r\n\tmethods: {\r\n\t\treset()\r\n\t\t{\r\n\t\t\tthis.currentStepIndex = 0;\r\n\t\t\tthis.fileRows = [];\r\n\t\t\tthis.file = '';\r\n\t\t\tthis.filePath = '';\r\n\r\n\t\t\tthis.settings = {\r\n\t\t\t\tcodeIndex: undefined,\r\n\t\t\t\tquantityIndex: undefined\r\n\t\t\t}\r\n\r\n\t\t\tthis.result = {};\r\n\t\t},\r\n\r\n\t\tstartLoader()\r\n\t\t{\r\n\t\t\tthis.$emit('startLoader')\r\n\t\t},\r\n\r\n\t\tendLoader()\r\n\t\t{\r\n\t\t\tthis.$emit('endLoader')\r\n\t\t},\r\n\r\n\t\tvalidateFileInput()\r\n\t\t{\r\n\t\t\tconst fileInput = this.$refs.fileInput;\r\n\t\t\tconst file = (fileInput.files || [])[0];\r\n\r\n\t\t\tthis.filePath = fileInput.value;\r\n\r\n\t\t\tif (file)\r\n\t\t\t{\r\n\t\t\t\tfileInput.classList.remove('is-invalid');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfileInput.classList.add('is-invalid');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thandleStep(step)\r\n\t\t{\r\n\t\t\tthis.currentStepIndex = step.index;\r\n\t\t},\r\n\r\n\t\tasync next(step)\r\n\t\t{\r\n\t\t\tswitch(step.name)\r\n\t\t\t{\r\n\t\t\t\tcase 'step1':\r\n\r\n\t\t\t\t\ttry \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.startLoader();\r\n\r\n\t\t\t\t\t\tif (await this.processReadFile())\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tstep.next();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e) {}\r\n\t\t\t\t\tfinally\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.endLoader();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'step2':\r\n\r\n\t\t\t\t\ttry \r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.startLoader();\r\n\t\t\t\t\t\tstep.next();\r\n\t\t\t\t\t\tawait this.addtobasket();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e) {}\r\n\t\t\t\t\tfinally\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.endLoader();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync back(step)\r\n\t\t{\r\n\t\t\tstep.back();\r\n\t\t},\r\n\r\n\t\tasync processReadFile()\r\n\t\t{\r\n\t\t\tif (this.method === 'upload')\r\n\t\t\t{\r\n\t\t\t\treturn this.processReadFileByUpload();\r\n\t\t\t}\r\n\t\t\telse if (this.method === 'link')\r\n\t\t\t{\r\n\t\t\t\treturn this.processReadFileByPath();\r\n\t\t\t}\r\n\r\n\t\t\tthrow new Error('Wrong file upload method');\r\n\t\t},\r\n\r\n\t\tasync processReadFileByUpload()\r\n\t\t{\r\n\t\t\tconst fileInput = this.$refs.fileInput;\r\n\t\t\tconst file = (fileInput.files || [])[0];\r\n\r\n\t\t\tif (file)\r\n\t\t\t{\r\n\t\t\t\tconst formData = new FormData();\r\n\t\t\t\tformData.append('file', file);\r\n\t\t\t\tformData.append('signedParamaters', this.signedParameters);\r\n\t\t\t\tformData.append('sessid', BX.bitrix_sessid());\r\n\r\n\t\t\t\tthis.fileRows = await parseFile(formData);\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfileInput.classList.add('is-invalid');\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tasync processReadFileByPath()\r\n\t\t{\r\n\t\t\tthis.fileRows = await parseFile({\r\n\t\t\t\tpath: this.filePath,\r\n\t\t\t\tsignedParameters: this.signedParameters\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tprepareData()\r\n\t\t{\r\n\t\t\tlet data = {};\r\n\t\t\tconst rows=  [...this.fileRows];\r\n\r\n\t\t\tif (this.skipFirstRow)\r\n\t\t\t{\r\n\t\t\t\trows.shift();\r\n\t\t\t}\r\n\r\n\t\t\tfor (const row of rows)\r\n\t\t\t{\r\n\t\t\t\tconst codeStr = new String(row[this.settings.codeIndex - 1]);\r\n\t\t\t\tif (codeStr.trim() !== '')\r\n\t\t\t\t{\r\n\t\t\t\t\tdata[codeStr] = row[this.settings.quantityIndex - 1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\tasync addtobasket()\r\n\t\t{\r\n\t\t\tif (this.fileRows.length === 0)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst data = this.prepareData();\r\n\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tconst result = await addtobasket({\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tsignedParameters: this.signedParameters\t\r\n\t\t\t\t});\r\n\t\r\n\t\t\t\tthis.result = result;\r\n\t\t\t\tthis.$store.dispatch('cart/fetch');\r\n\t\t\t}\r\n\t\t\tcatch(e)\r\n\t\t\t{\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\twatch: {\r\n\t\tfileRows(newVal)\r\n\t\t{\r\n\t\t\tif (this.fileRows.length > 0)\r\n\t\t\t{\r\n\t\t\t\tif ( this.fileRows[0].length === 5)\r\n\t\t\t\t{\r\n\t\t\t\t\t// default export\r\n\t\t\t\t\tthis.settings.codeIndex = 2;\r\n\t\t\t\t\tthis.settings.quantityIndex = 4;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.settings.codeIndex = this.fileRows[0].length > 0 ? 1 : undefined\r\n\t\t\t\t\tthis.settings.quantityIndex = this.fileRows[0].length > 1 ? 2 : undefined\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n} \r\n</script>\r\n","import FileImport from './FileImport.vue';\r\n\r\nconst { store } = B2BPortal;\r\n\r\nexport class BasketFileImport\r\n{\r\n\tconstructor(params)\r\n\t{\r\n\t\tthis._params = params;\r\n\t\tthis.el = params.el;\r\n\t\tthis.modal = params.modal;\r\n\t\tthis.signedParameters = params.signedParameters;\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit()\r\n\t{\r\n\t\tconst signedParameters = this.signedParameters;\r\n\r\n\t\tconst startLoader = () => KTApp.block(this.modal);\r\n\t\tconst endLoader = () => KTApp.unblock(this.modal);\r\n\r\n\t\tthis.component = new Vue({\r\n\t\t\tel: this.el,\r\n\t\t\tcomponents: { FileImport: FileImport },\r\n\t\t\ttemplate: `<FileImport ref=\"fileImport\" :signedParameters=\"signedParameters\"/>`,\r\n\t\t\tstore,\r\n\r\n\t\t\tdata()\r\n\t\t\t{\r\n\t\t\t\treturn { signedParameters }\r\n\t\t\t},\r\n\r\n\t\t\tmounted()\r\n\t\t\t{\r\n\t\t\t\tthis.$refs.fileImport.$on('startLoader', startLoader);\r\n\t\t\t\tthis.$refs.fileImport.$on('endLoader', endLoader);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n} "],"names":["action","actionName","data","resultData","undefined","Promise","resolve","reject","BX","ajax","runComponentAction","mode","then","result","global","toastr","error","errors","message","addtobasket","onCustomEvent","parseFile","components","Stepper","B2BPortal","Vue","Components","props","signedParameters","type","String","default","currentStepIndex","steps","Object","freeze","method","file","filePath","fileRows","skipFirstRow","settings","codeIndex","quantityIndex","computed","fileData","highestColumn","reduce","highest","row","Math","max","length","messages","keys","filter","startsWith","obj","slice","methods","reset","startLoader","$emit","endLoader","validateFileInput","fileInput","$refs","files","value","classList","remove","add","handleStep","step","index","next","name","processReadFile","back","processReadFileByUpload","processReadFileByPath","Error","formData","FormData","append","bitrix_sessid","path","prepareData","rows","shift","codeStr","trim","$store","dispatch","console","watch","newVal","normalizeComponent","template","style","script","scopeId","isFunctionalTemplate","moduleIdentifier","shadowMode","createInjector","createInjectorSSR","createInjectorShadow","options","render","staticRenderFns","_compiled","functional","_scopeId","hook","context","$vnode","ssrContext","parent","__VUE_SSR_CONTEXT__","call","_registeredComponents","_ssrRegister","$root","$options","shadowRoot","originalRender","renderWithStyleInjection","h","existing","beforeCreate","concat","normalizeComponent_1","store","BasketFileImport","params","_params","el","modal","init","KTApp","block","unblock","component","FileImport","mounted","fileImport","$on"],"mappings":"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"}