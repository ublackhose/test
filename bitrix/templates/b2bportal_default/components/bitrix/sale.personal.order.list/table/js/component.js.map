{"version":3,"file":"component.js","sources":["../src/component.js"],"sourcesContent":["export class SalePersonalOrderList\n{\n\tconstructor(el, container, data = {})\n\t{\n\t\tthis.$el = el;\n\t\tthis.$container = container;\n\n\t\tthis.columns = data.columns || {};\n\t\tthis.rows = data.rows || {};\n\t\tthis.pagination = data.pagination || {};\n\t\tthis.sort = data.sort || {};\n\n\t\tthis.eventBus = new Vue();\n\n\t\tthis.attachTemplate();\n\t\tthis.handleEvents();\n\t}\n\n\tasync sendRequest(url, data)\n\t{\n\t\tKTApp.block(this.$container);\n\n\t\tconst result = await this.fetch(url, data);\n\n\t\tif ((result.data || {}).rows)\n\t\t{\n\t\t\tthis.rows = result.data.rows;\n\t\t\tthis.$template.$emit('setRows', result.data.rows);\n\t\t}\n\n\t\tif ((result.data || {}).pagination)\n\t\t{\n\t\t\tthis.pagination = result.data.pagination;\n\t\t\tthis.$template.$emit('setNav', result.data.pagination);\n\t\t}\n\n\t\tBX.ajax.history.put(null, url)\n\t\t\n\t\tKTApp.unblock(this.$container);\n\n\t\treturn result;\n\t}\n\n\tfetch(url, data)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax({\n\t\t\t\turl: url,\n\t\t\t\tdata: data,\n\t\t\t\tdataType: 'json',\n\t\t\t\tonsuccess: resolve,\n\t\t\t\tonfailure: reject\n\t\t\t});\n\t\t});\n\t\t// return fetch(url, params).then(response => response.json());\n\t}\n\n\tattachTemplate()\n\t{\n\t\tconst columns = this.columns;\n\t\tconst rows = this.rows;\n\t\tconst pagination = this.pagination;\n\t\tconst sort = this.sort;\n\n\n\t\tthis.$template = new Vue({\n\n\t\t\tname: 'SalePersonalOrderList',\n\t\t\t\n\t\t\tel: this.$el,\n\n\t\t\tcomponents: {\n\t\t\t\t'vue-table': B2BPortal.Vue.Components.VueTable\n\t\t\t},\n\n\t\t\tdata()\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tcolumns,\n\t\t\t\t\trows,\n\t\t\t\t\tpagination,\n\t\t\t\t\tsort\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcomputed: {\n\t\t\t\tmessages()\n\t\t\t\t{\n\t\t\t\t\treturn (\n\t\t\t\t\t\tObject.freeze(\n\t\t\t\t\t\t\tObject.keys(BX.message).filter(message => message.startsWith('SPOL'))\n\t\t\t\t\t\t\t\t.reduce((obj, message) => { obj[message.slice(message)] = BX.message(message); return obj; }, {})\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tenablePagenavigation()\n\t\t\t\t{\n\t\t\t\t\treturn Number(this.pagination.totalRecords) > Number(this.pagination.perPage);\n\t\t\t\t},\n\t\t\t\texpandedRows()\n\t\t\t\t{\n\t\t\t\t\treturn this.rows.reduce((indexes, row, index) => {\n\t\t\t\t\t\tif (row._IS_EXPAND) indexes.push(index);\n\n\t\t\t\t\t\treturn indexes;\n\t\t\t\t\t}, []);\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tcreated()\n\t\t\t{\n\t\t\t\tthis.rows.forEach(row => this.$set(row, '_IS_EXPAND', false));\n\t\t\t},\n\n\t\t\tmounted()\n\t\t\t{\n\t\t\t\tthis.$on('setRows', rows => {\n\t\t\t\t\tthis.rows = rows.map(row => {\n\t\t\t\t\t\tthis.$set(row, '_IS_EXPAND', false)\n\t\t\t\t\t\treturn row;\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.$on('setNav', pagination => {\n\t\t\t\t\tthis.pagination = pagination;\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tmethods: {\n\t\t\t\t\n\t\t\t\thandleRowClick(params)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href = params.row.url;\n\t\t\t\t},\n\t\t\t},\n\t\t\t\n\t\t\ttemplate: `\n\t\t\t\t<vue-table\n\t\t\t\t\tmode=\"remote\"\n\t\t\t\t\t:columns=\"columns\" \n\t\t\t\t\t:rows=\"rows\"\n\t\t\t\t\t:pagination-options=\"{\n\t\t\t\t\t\tenabled: enablePagenavigation,\n\t\t\t\t\t\thideRowCount: true,\n\t\t\t\t\t\tsetCurrentPage: pagination.currentPage,\n\t\t\t\t\t\tperPage: pagination.perPage,\n\t\t\t\t\t\tperPageDropdown: false,\n\t\t\t\t\t}\"\n\t\t\t\t\t:sort-options=\"{\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tinitialSortBy: sort\n\t\t\t\t\t}\"\n\t\t\t\t\t@on-sort-change=\"$emit('onSortChange', $event[0]);\"\n\t\t\t\t\t@on-page-change=\"$emit('onPageChange', $event);\"\n\t\t\t\t\t@on-per-page-change=\"$emit('onPageChange', $event);\"\n\t\t\t\t\t:totalRows=\"pagination.totalRecords\"\n\t\t\t\t\t:expandedRows=\"expandedRows\"\n\t\t\t\t>\n\t\t\t\t\t<template slot=\"table-row\" slot-scope=\"props\">\n\n\t\t\t\t\t\t<template v-if=\"props.column.field === 'ID'\">\n\t\t\t\t\t\t\t<a :href=\"props.row.urlToDetail\">{{ props.row.accountNumber }}</a>\n\n\t\t\t\t\t\t\t<div class=\"d-block\">\n\t\t\t\t\t\t\t\t<a href=\"#\" class=\"small\" @click.prevent=\"rows[props.index]._IS_EXPAND = !props.row._IS_EXPAND\" v-if=\"props.row.items.length\">\n\t\t\t\t\t\t\t\t\t{{ messages.SPOL_TPL_ORDER_LIST }}\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-angle-down\" v-if=\"!props.row._IS_EXPAND\"></i>\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-angle-up\" v-else></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-if=\"props.column.field === 'DATE_INSERT'\">\n\t\t\t\t\t\t\t<a :href=\"props.row.urlToDetail\">{{ props.row.dateInsert }}</a>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else-if=\"props.column.field === 'STATUS_ID'\">\n\t\t\t\t\t\t\t<div v-if=\"props.row.status && props.row.status != ''\">\n\t\t\t\t\t\t\t\t<span class=\"kt-badge kt-badge--inline kt-badge--pill kt-badge--primary text-nowrap\" :style=\"{'background-color': props.row.status.color}\" v-html=\"props.row.status.name\"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else-if=\"props.column.field === 'PRICE'\">\n\t\t\t\t\t\t\t<div v-html=\"props.row.formatedPrice\"></div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else-if=\"props.column.field === 'PAYED'\">\n\t\t\t\t\t\t\t<span v-if=\"props.row.payed\"> <span class=\"\">{{messages.SPOL_TPL_PAID}}</span><br>{{props.row.datePayed}} </span>\n\t\t\t\t\t\t\t<span v-else class=\"\">{{ messages.SPOL_TPL_NOTPAID }}</span>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else-if=\"props.column.field === 'shipment'\">\n\t\t\t\t\t\t\t<div v-for=\"(shipment, index) in props.row.shipments\" :key=\"index\">\n\t\t\t\t\t\t\t\t<span v-if=\"shipment.length > 1\">{{shipment.deliveryName}}: </span>\n\t\t\t\t\t\t\t\t<span v-if=\"shipment.deducted\"><span class=\"\">{{messages.SPOL_TPL_LOADED}}</span><br>{{shipment.dateDeducted}}</span>\n\t\t\t\t\t\t\t\t<span v-else class=\"\">{{messages.SPOL_TPL_NOTLOADED}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else-if=\"props.column.field === 'actions'\">\n\t\t\t\t\t\t\t<div v-if=\"props.row.urlToCopy && props.row.urlToCopy != ''\">\n\t\t\t\t\t\t\t\t<a :href=\"props.row.urlToCopy\">{{ messages.SPOL_TPL_REPEAT_ORDER }}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if=\"props.row.canceled\">\n\t\t\t\t\t\t\t\t{{ messages.SPOL_TPL_ORDER_CANCELED }} <b>{{props.row.dateCanceled}}</b>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-else-if=\"props.row.urlToCancel && props.row.urlToCancel != ''\">\n\t\t\t\t\t\t\t\t<a :href=\"props.row.urlToCancel\">{{ messages.SPOL_TPL_CANCEL_ORDER }}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t{{ props.row[props.column.field] }}\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<div slot=\"emptystate\">\n\t\t\t\t\t\t<div class=\"text-center\">{{ messages.SUP_TICKET_NOT_FOUND }}</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<template slot=\"expanded-row\" slot-scope=\"props\">\n\t\t\t\t\t\t<table class=\"table bg-white\">\n\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>{{ messages.SPOL_TPL_ORDER_ITEM_NAME }}</td>\n\t\t\t\t\t\t\t\t\t<td>{{ messages.SPOL_TPL_ORDER_ITEM_PRICE }}</td>\n\t\t\t\t\t\t\t\t\t<td>{{ messages.SPOL_TPL_ORDER_ITEM_QUANTITY }}</td>\n\t\t\t\t\t\t\t\t\t<td>{{ messages.SPOL_TPL_ORDER_ITEM_SUM }}</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t<tr v-for=\"item in props.row.items\" :key=\"item.id\">\n\t\t\t\t\t\t\t\t\t<td v-html=\"item.name\"></td>\n\t\t\t\t\t\t\t\t\t<td v-html=\"item.priceFormatted\"></td>\n\t\t\t\t\t\t\t\t\t<td>{{ item.quantity }}</td>\n\t\t\t\t\t\t\t\t\t<td v-html=\"item.sumFormatted\"></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</template>\n\t\t\t\t</vue-table>\n\t\t\t`\n\t\t});\n\t}\n\n\thandleEvents()\n\t{\n\t\tthis.$template.$on('onSortChange', this.sorting.bind(this));\n\t\tthis.$template.$on('onPageChange', this.nav.bind(this));\n\t}\n\n\tsorting(params)\n\t{\n\t\tconst url = BX.util.add_url_param(window.location.href, {\n\t\t\tby: params.field,\n\t\t\torder: params.type.toUpperCase()\n\t\t});\n\n\t\tthis.sendRequest(url);\n\t}\n\n\tnav(params)\n\t{\n\t\tconst navParams = {};\n\t\tnavParams[this.pagination.navName] = params.currentPage;\n\n\t\tconst url = BX.util.add_url_param(window.location.href, navParams);\n\t\tthis.sendRequest(url);\n\t}\n}"],"names":["SalePersonalOrderList","el","container","data","$el","$container","columns","rows","pagination","sort","eventBus","Vue","attachTemplate","handleEvents","url","KTApp","block","fetch","result","$template","$emit","BX","ajax","history","put","unblock","Promise","resolve","reject","dataType","onsuccess","onfailure","name","components","B2BPortal","Components","VueTable","computed","messages","Object","freeze","keys","message","filter","startsWith","reduce","obj","slice","enablePagenavigation","Number","totalRecords","perPage","expandedRows","indexes","row","index","_IS_EXPAND","push","created","forEach","$set","mounted","$on","map","methods","handleRowClick","params","window","location","href","template","sorting","bind","nav","util","add_url_param","by","field","order","type","toUpperCase","sendRequest","navParams","navName","currentPage"],"mappings":"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"}