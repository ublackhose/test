{"version":3,"file":"filter_conditions.bundle.js","sources":["../src/filter_conditions.js"],"sourcesContent":["export class FilterConditions\n{\n\tstatic get PROPERTY_PREFIX()\n\t{\n\t\treturn 'CondIBProp';\n\t}\n\n\tstatic get ALLOWED_FIELDS()\n\t{\n\t\treturn [\n\t\t\t'CondIBXmlID', 'CondIBSection', 'CondIBDateActiveFrom', 'CondIBDateActiveTo',\n\t\t\t'CondIBSort', 'CondIBDateCreate', 'CondIBCreatedBy', 'CondIBTimestampX', 'CondIBModifiedBy',\n\t\t\t'CondIBTags', 'CondCatQuantity', 'CondCatWeight'\n\t\t];\n\t}\n\n\tconstructor(options = {})\n\t{\n\t\tthis.contId = options.contId;\n\n\t\tBX.addCustomEvent(\n\t\t\t'onTreeConditionsInit', \n\t\t\tthis.initTree.bind(this)\n\t\t);\n\t}\n\n\tinitTree(arParams, obTree, obControls)\n\t{\n\t\tif (this.contId !== arParams.parentContainer)\n\t\t\treturn;\n\n\t\tthis.arParams = arParams;\n\t\tthis.obTree = obTree;\n\t\tthis.obControls = obControls;\n\n\t\tthis.modifyTreeParams();\n\t}\n\n\tmodifyTreeParams()\n\t{\n\t\tthis.obControls\n\t\t\t.filter(control => control.group)\n\t\t\t.forEach(this.modifyCondGroup)\n\n\t\tthis.obControls\n\t\t\t.filter(control => !control.group)\n\t\t\t.forEach(this.modifyCondValueGroup)\n\t}\n\n\tmodifyCondGroup({ visual, control })\n\t{\n\t\tif (visual)\n\t\t{\n\t\t\tvisual.values.filter(v => v.True === 'False')\n\t\t\t\t.forEach((v, k) => {\n\t\t\t\t\tvisual.values.splice(k, 1);\n\t\t\t\t\tvisual.logic.splice(k, 1)\n\t\t\t\t});\n\t\t}\n\n\t\tif (control)\n\t\t{\n\t\t\tcontrol.forEach((v, k) => {\n\t\t\t\tv.dontShowFirstOption = true;\n\n\t\t\t\tif (v.id === 'True')\n\t\t\t\t\tdelete v.values.False;\n\t\t\t})\n\t\t}\n\t}\n\n\tmodifyCondValueGroup(ctrl)\n\t{\n\t\tif (!((ctrl || {}).children || []).length)\n\t\t\treturn;\n\n\t\tctrl.children = ctrl.children.filter(({ controlId }) => {\n\t\t\tconst [ controlName, iblockId, propertyId ] = controlId.split(':');\n\t\t\treturn (\n\t\t\t\tFilterConditions.ALLOWED_FIELDS.includes(controlId) ||\n\t\t\t\t(controlName === FilterConditions.PROPERTY_PREFIX && propertyId)\n\t\t\t);\n\t\t});\n\t}\n}"],"names":["FilterConditions","options","contId","BX","addCustomEvent","initTree","bind","arParams","obTree","obControls","parentContainer","modifyTreeParams","filter","control","group","forEach","modifyCondGroup","modifyCondValueGroup","visual","values","v","True","k","splice","logic","dontShowFirstOption","id","False","ctrl","children","length","controlId","split","controlName","iblockId","propertyId","ALLOWED_FIELDS","includes","PROPERTY_PREFIX"],"mappings":";;;;KAAaA,gBAAb;CAAA;CAAA;CAAA,wBAGC;CACC,aAAO,YAAP;CACA;CALF;CAAA;CAAA,wBAQC;CACC,aAAO,CACN,aADM,EACS,eADT,EAC0B,sBAD1B,EACkD,oBADlD,EAEN,YAFM,EAEQ,kBAFR,EAE4B,iBAF5B,EAE+C,kBAF/C,EAEmE,kBAFnE,EAGN,YAHM,EAGQ,iBAHR,EAG2B,eAH3B,CAAP;CAKA;CAdF;;CAgBC,8BACA;CAAA,QADYC,OACZ,uEADsB,EACtB;CAAA;CACC,SAAKC,MAAL,GAAcD,OAAO,CAACC,MAAtB;CAEAC,IAAAA,EAAE,CAACC,cAAH,CACC,sBADD,EAEC,KAAKC,QAAL,CAAcC,IAAd,CAAmB,IAAnB,CAFD;CAIA;;CAxBF;CAAA;CAAA,6BA0BUC,QA1BV,EA0BoBC,MA1BpB,EA0B4BC,UA1B5B,EA2BC;CACC,UAAI,KAAKP,MAAL,KAAgBK,QAAQ,CAACG,eAA7B,EACC;CAED,WAAKH,QAAL,GAAgBA,QAAhB;CACA,WAAKC,MAAL,GAAcA,MAAd;CACA,WAAKC,UAAL,GAAkBA,UAAlB;CAEA,WAAKE,gBAAL;CACA;CApCF;CAAA;CAAA,uCAuCC;CACC,WAAKF,UAAL,CACEG,MADF,CACS,UAAAC,OAAO;CAAA,eAAIA,OAAO,CAACC,KAAZ;CAAA,OADhB,EAEEC,OAFF,CAEU,KAAKC,eAFf;CAIA,WAAKP,UAAL,CACEG,MADF,CACS,UAAAC,OAAO;CAAA,eAAI,CAACA,OAAO,CAACC,KAAb;CAAA,OADhB,EAEEC,OAFF,CAEU,KAAKE,oBAFf;CAGA;CA/CF;CAAA;CAAA,0CAkDC;CAAA,UADkBC,MAClB,QADkBA,MAClB;CAAA,UAD0BL,OAC1B,QAD0BA,OAC1B;;CACC,UAAIK,MAAJ,EACA;CACCA,QAAAA,MAAM,CAACC,MAAP,CAAcP,MAAd,CAAqB,UAAAQ,CAAC;CAAA,iBAAIA,CAAC,CAACC,IAAF,KAAW,OAAf;CAAA,SAAtB,EACEN,OADF,CACU,UAACK,CAAD,EAAIE,CAAJ,EAAU;CAClBJ,UAAAA,MAAM,CAACC,MAAP,CAAcI,MAAd,CAAqBD,CAArB,EAAwB,CAAxB;CACAJ,UAAAA,MAAM,CAACM,KAAP,CAAaD,MAAb,CAAoBD,CAApB,EAAuB,CAAvB;CACA,SAJF;CAKA;;CAED,UAAIT,OAAJ,EACA;CACCA,QAAAA,OAAO,CAACE,OAAR,CAAgB,UAACK,CAAD,EAAIE,CAAJ,EAAU;CACzBF,UAAAA,CAAC,CAACK,mBAAF,GAAwB,IAAxB;CAEA,cAAIL,CAAC,CAACM,EAAF,KAAS,MAAb,EACC,OAAON,CAAC,CAACD,MAAF,CAASQ,KAAhB;CACD,SALD;CAMA;CACD;CArEF;CAAA;CAAA,yCAuEsBC,IAvEtB,EAwEC;CACC,UAAI,CAAC,CAAC,CAACA,IAAI,IAAI,EAAT,EAAaC,QAAb,IAAyB,EAA1B,EAA8BC,MAAnC,EACC;CAEDF,MAAAA,IAAI,CAACC,QAAL,GAAgBD,IAAI,CAACC,QAAL,CAAcjB,MAAd,CAAqB,iBAAmB;CAAA,YAAhBmB,SAAgB,SAAhBA,SAAgB;;CAAA,+BACTA,SAAS,CAACC,KAAV,CAAgB,GAAhB,CADS;CAAA;CAAA,YAC/CC,WAD+C;CAAA,YAClCC,QADkC;CAAA,YACxBC,UADwB;;CAEvD,eACCnC,gBAAgB,CAACoC,cAAjB,CAAgCC,QAAhC,CAAyCN,SAAzC,KACCE,WAAW,KAAKjC,gBAAgB,CAACsC,eAAjC,IAAoDH,UAFtD;CAIA,OANe,CAAhB;CAOA;CAnFF;CAAA;CAAA;;;;;;;;"}