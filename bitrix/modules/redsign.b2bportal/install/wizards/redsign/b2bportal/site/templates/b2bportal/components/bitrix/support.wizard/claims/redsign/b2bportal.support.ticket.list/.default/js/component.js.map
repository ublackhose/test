{"version":3,"file":"component.js","sources":["../src/utils.js","../src/component.js"],"sourcesContent":["export function addUrlParams(url, params)\n{\n\treturn BX.util.add_url_param(url, params);\n}","import { addUrlParams } from './utils';\n\nexport class SupportTicketList\n{\n\tconstructor(el, container, data = {})\n\t{\n\t\tthis.$el = el;\n\t\tthis.$container = container;\n\n\t\tthis.columns = data.columns || {};\n\t\tthis.rows = data.rows || {};\n\t\tthis.pagination = data.pagination || {};\n\t\tthis.sort = data.sort || {};\n\n\t\tthis.eventBus = new Vue();\n\n\t\tthis.attachTemplate();\n\t\tthis.handleEvents();\n\t}\n\n\tasync sendRequest(url, data)\n\t{\n\t\tKTApp.block(this.$container);\n\n\t\tconst result = await this.fetch(url, data);\n\n\t\tif ((result.data || {}).rows)\n\t\t{\n\t\t\tthis.rows = result.data.rows;\n\t\t\tthis.$template.$emit('setRows', result.data.rows);\n\t\t}\n\n\t\tif ((result.data || {}).pagination)\n\t\t{\n\t\t\tthis.pagination = result.data.pagination;\n\t\t\tthis.$template.$emit('setNav', result.data.pagination);\n\t\t}\n\n\t\tBX.ajax.history.put(null, url)\n\t\t\n\t\tKTApp.unblock(this.$container);\n\n\t\treturn result;\n\t}\n\n\tfetch(url, data)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax({\n\t\t\t\turl: url,\n\t\t\t\tdata: data,\n\t\t\t\tdataType: 'json',\n\t\t\t\tonsuccess: resolve,\n\t\t\t\tonfailure: reject\n\t\t\t});\n\t\t});\n\t\t// return fetch(url, params).then(response => response.json());\n\t}\n\n\tattachTemplate()\n\t{\n\t\tconst columns = this.columns;\n\t\tconst rows = this.rows;\n\t\tconst pagination = this.pagination;\n\t\tconst sort = this.sort;\n\t\t\n\t\tthis.$template = new Vue({\n\t\t\t\n\t\t\tel: this.$el,\n\n\t\t\tcomponents: {\n\t\t\t\t'vue-table': B2BPortal.Vue.Components.VueTable\n\t\t\t},\n\n\t\t\tdata()\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tcolumns,\n\t\t\t\t\trows,\n\t\t\t\t\tpagination,\n\t\t\t\t\tsort\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcomputed: {\n\t\t\t\tmessages()\n\t\t\t\t{\n\t\t\t\t\treturn Object.freeze({\n\t\t\t\t\t\t'SUP_TICKET_NOT_FOUND': BX.message('SUP_TICKET_NOT_FOUND')\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmounted()\n\t\t\t{\n\t\t\t\tthis.$on('setRows', rows => {\n\t\t\t\t\tthis.rows = rows;\n\t\t\t\t});\n\n\t\t\t\tthis.$on('setNav', pagination => {\n\t\t\t\t\tthis.pagination = pagination;\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tmethods: {\n\t\t\t\t\n\t\t\t\thandleRowClick(params)\n\t\t\t\t{\n\t\t\t\t\twindow.location.href = params.row.url;\n\t\t\t\t},\n\t\t\t},\n\t\t\t\n\t\t\ttemplate: `\n\t\t\t\t<vue-table\n\t\t\t\t\tmode=\"remote\"\n\t\t\t\t\t:columns=\"columns\" \n\t\t\t\t\t:rows=\"rows\"\n\t\t\t\t\t:pagination-options=\"{\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\thideRowCount: true,\n\t\t\t\t\t\tsetCurrentPage: pagination.currentPage,\n\t\t\t\t\t\tperPage: pagination.perPage,\n\t\t\t\t\t\tperPageDropdown: false,\n\t\t\t\t\t}\"\n\t\t\t\t\t:sort-options=\"{\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tinitialSortBy: sort\n\t\t\t\t\t}\"\n\t\t\t\t\t@on-row-click=\"handleRowClick\"\n\t\t\t\t\t@on-sort-change=\"$emit('onSortChange', $event[0]);\"\n\t\t\t\t\t@on-page-change=\"$emit('onPageChange', $event);\"\n\t\t\t\t\t@on-per-page-change=\"$emit('onPageChange', $event);\"\n\t\t\t\t\t:totalRows=\"pagination.totalRecords\"\n\t\t\t\t>\n\t\t\t\t\t<template slot=\"table-row\" slot-scope=\"props\">\n\n\t\t\t\t\t\t<template v-if=\"props.column.field === 's_id'\">\n\t\t\t\t\t\t\t<div><a :href=\"props.row.url\">#{{props.row[props.column.field]}}</a></div>\n\t\t\t\t\t\t\t<div class=\"text-muted\">{{props.row.created}}</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else-if=\"props.column.field === 's_title'\">\n\t\t\t\t\t\t\t<a :href=\"props.row.url\">{{props.row[props.column.field]}}</a>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t<div v-html=\"props.row[props.column.field]\"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<div slot=\"emptystate\">\n\t\t\t\t\t\t<div class=\"text-center\">{{ messages.SUP_TICKET_NOT_FOUND }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</vue-table>\n\t\t\t`\n\t\t});\n\t}\n\n\thandleEvents()\n\t{\n\t\tthis.$template.$on('onSortChange', this.sorting.bind(this));\n\t\tthis.$template.$on('onPageChange', this.nav.bind(this));\n\t}\n\n\tsorting(params)\n\t{\n\t\tconst url = addUrlParams(window.location.pathname, {\n\t\t\tby: params.field,\n\t\t\torder: params.type\n\t\t});\n\n\t\tthis.sendRequest(url);\n\t}\n\n\tnav(params)\n\t{\n\t\tconst navParams = {};\n\t\tnavParams[this.pagination.navName] = params.currentPage;\n\n\t\tconst url = addUrlParams(window.location.href, navParams);\n\t\tthis.sendRequest(url);\n\t}\n}"],"names":["addUrlParams","url","params","BX","util","add_url_param","SupportTicketList","el","container","data","$el","$container","columns","rows","pagination","sort","eventBus","Vue","attachTemplate","handleEvents","KTApp","block","fetch","result","$template","$emit","ajax","history","put","unblock","Promise","resolve","reject","dataType","onsuccess","onfailure","components","B2BPortal","Components","VueTable","computed","messages","Object","freeze","message","mounted","$on","methods","handleRowClick","window","location","href","row","template","sorting","bind","nav","pathname","by","field","order","type","sendRequest","navParams","navName","currentPage"],"mappings":"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"}