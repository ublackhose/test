{"version":3,"file":"component.js","sources":["../src/component.js"],"sourcesContent":["export class SaleOrderPaymentChange\n{\n\tconstructor($el, params)\n\t{\n\t\tthis.$el = $el;\n\n\t\tthis.ajaxPath = params.ajaxPath;\n\t\tthis.accountNumber = params.accountNumber || {};\n\t\tthis.paymentNumber = params.paymentNumber || {};\n\t\tthis.onlyInnerFull = params.onlyInnerFull || \"\";\n\t\tthis.templateName = params.templateName || \"\";\n\t\tthis.pathToPayment = params.pathToPayment || \"\";\n\t\tthis.refreshPrices = params.refreshPrices || \"N\";\n\t\tthis.inner = params.inner || \"\";\n\t\tthis.templateFolder = params.templateFolder;\n\n\t\tthis.initEvents();\n\t}\n\n\tinitEvents()\n\t{\n\t\tconst pyamentNodes = this.$el.querySelectorAll('[data-entity=\"paysystem\"]');\n\t\tif (pyamentNodes.length)\n\t\t{\n\t\t\tfor (let i in pyamentNodes)\n\t\t\t{\n\t\t\t\tif (pyamentNodes.hasOwnProperty(i))\n\t\t\t\t{\n\t\t\t\t\tpyamentNodes[i].addEventListener('click', this.onSelectPaymentHandle.bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync onSelectPaymentHandle(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst node = event.currentTarget || event.target.closest('[data-entity=\"paysystem\"]');\n\t\tconst paysystemId = node.getAttribute('data-paysystem-id');\n\t\t\n\t\ttry\n\t\t{\n\t\t\tconst result = await this.changePaysystem(paysystemId);\n\t\t\t\n\t\t\tconst messages = result.messages;\n\t\t\tif (messages.length > 0) \n\t\t\t{\n\t\t\t\tthis.showMessages(messages);\n\t\t\t}\n\n\t\t\tif (result.isInnerPayment)\n\t\t\t{\n\t\t\t\tawait this.innerPay(\n\t\t\t\t\tresult.innerPaymentData, \n\t\t\t\t\tresult.isOnlyInnerFull\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tBX.onCustomEvent('SaleOrderDetailPaysystemChanged');\n\t\t}\n\t\tcatch(e)\n\t\t{\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n\n\tshowMessages(messages = [])\n\t{\n\t\tmessages.forEach(message => {\n\t\t\t\n\t\t\tif (message.type === 'error')\n\t\t\t{\n\t\t\t\tSwal.fire({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\ttext: message.text\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.toastr[message.type](message.text);\n\t\t\t}\n\t\t\t\n\t\t});\n\t}\n\n\tasync innerPay(data, isOnlyFull)\n\t{\n\t\tif (isOnlyFull)\n\t\t{\n\t\t\tconst confirmInnerPay = await this.confirmInnerPay(data);\n\t\t\tif (confirmInnerPay)\n\t\t\t{\n\t\t\t\tawait this.sendInnerPay(data.sum);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst sum = await this.promptInnerPay(data);\n\t\t\tawait this.sendInnerPay(sum);\n\t\t}\n\t}\n\n\tconfirmInnerPay(data)\n\t{\n\t\treturn (\n\t\t\tSwal.fire({\n\t\t\t\ttitle: BX.message('SOPC_TPL_SUM_TO_PAID') + ': ' + data.sumFormatted,\n\t\t\t\ttype: 'warning',\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonText: BX.message('SOPC_TPL_PAY_BUTTON'),\n\t\t\t\tcancelButtonText: BX.message('SOPC_TPL_PAY_CANCEL')\n\t\t\t})\n\t\t\t.then((result) => result.value)\n\t\t);\n\t}\n\n\tpromptInnerPay(data)\n\t{\n\t\tconst sum = Number(data.sum);\n\t\tconst budget = Number(data.budget);\n\n\t\treturn (\n\t\t\tSwal.fire({\n\t\t\t\ttitle: BX.message('SOPC_TPL_SUM_TO_PAID') + ': ' + data.sumFormatted,\n\t\t\t\tinput: 'number',\n\t\t\t\tinputAttributes: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: budget >= sum ? sum : budget\n\t\t\t\t},\n\t\t\t\tinputValue: budget >= sum ? sum : budget,\n\t\t\t\tshowCancelButton: true,\n\t\t\t\tconfirmButtonText: BX.message('SOPC_TPL_PAY_BUTTON'),\n\t\t\t\tcancelButtonText: BX.message('SOPC_TPL_PAY_CANCEL')\n\t\t\t})\n\t\t\t.then((result) => result.value)\n\t\t);\n\t}\n\n\tchangePaysystem(paysystemId)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: this.ajaxPath,\n\t\t\t\tdata: {\n\t\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\t\tpaySystemId: paysystemId,\n\t\t\t\t\taccountNumber: this.accountNumber,\n\t\t\t\t\tpaymentNumber: this.paymentNumber,\n\t\t\t\t\ttemplateName: this.templateName,\n\t\t\t\t\tinner: this.inner,\n\t\t\t\t\trefreshPrices: this.refreshPrices,\n\t\t\t\t\tonlyInnerFull: this.onlyInnerFull,\n\t\t\t\t\tpathToPayment: this.pathToPayment\n\t\t\t\t},\n\t\t\t\tonsuccess: resolve,\n\t\t\t\tonfailure: reject\n\t\t\t});\n\t\t});\n\t}\n\n\tsendInnerPay(sum)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: this.ajaxPath,\n\t\t\t\tdata: {\n\t\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\t\t\taccountNumber: this.accountNumber,\n\t\t\t\t\t\tpaymentNumber: this.paymentNumber,\n\t\t\t\t\t\tinner: \"Y\",\n\t\t\t\t\t\tonlyInnerFull: this.onlyInnerFull,\n\t\t\t\t\t\tpaymentSum: sum\n\t\t\t\t},\n\t\t\t\tonsuccess: resolve,\n\t\t\t\tonfailure: reject\n\t\t\t});\n\t\t});\n\t}\n}"],"names":["SaleOrderPaymentChange","$el","params","ajaxPath","accountNumber","paymentNumber","onlyInnerFull","templateName","pathToPayment","refreshPrices","inner","templateFolder","initEvents","pyamentNodes","querySelectorAll","length","i","hasOwnProperty","addEventListener","onSelectPaymentHandle","bind","event","preventDefault","node","currentTarget","target","closest","paysystemId","getAttribute","changePaysystem","result","messages","showMessages","isInnerPayment","innerPay","innerPaymentData","isOnlyInnerFull","BX","onCustomEvent","console","warn","forEach","message","type","Swal","fire","text","window","toastr","data","isOnlyFull","confirmInnerPay","sendInnerPay","sum","promptInnerPay","title","sumFormatted","showCancelButton","confirmButtonText","cancelButtonText","then","value","Number","budget","input","inputAttributes","min","max","inputValue","Promise","resolve","reject","ajax","method","dataType","url","sessid","bitrix_sessid","paySystemId","onsuccess","onfailure","paymentSum"],"mappings":"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"}