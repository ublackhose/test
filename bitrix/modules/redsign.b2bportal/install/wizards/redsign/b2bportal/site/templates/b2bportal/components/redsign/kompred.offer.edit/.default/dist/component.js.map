{"version":3,"file":"component.js","sources":["../src/component.js"],"sourcesContent":["export class KPEdit\n{\n\tconstructor(params)\n\t{\n\t\tthis.signedParameters = params.signedParameters;\n\t\tthis.editor = params.editor;\n\t\tthis.nameInput = params.nameInput;\n\t\tthis.linkInput = params.linkInput;\n\t\tthis.copyToClipboardButton = params.copyToClipboardButton;\n\t\tthis.deleteButton = params.deleteButton;\n\t\tthis.shortLinkToggle = params.shortLinkToggle;\n\n\t\tthis.download = params.download;\n\t\tthis.shortlink = params.shortlink;\n\t\tthis.isShowedShortlink = !!this.shortlink;\n\n\t\tthis.editor.subscribe(RSKomPred.Editor.Events.CHANGED, this.saveData.bind(this));\n\t\tthis.nameInput.addEventListener('change', this.saveData.bind(this));\n\t\tthis.copyToClipboardButton.addEventListener('click', this.copyClipboard.bind(this));\n\t\tthis.deleteButton.addEventListener('click', this.confirmDelete.bind(this));\n\t\tthis.shortLinkToggle.addEventListener('click', this.toggleShortlink.bind(this));\n\t}\n\n\tasync saveData()\n\t{\n\t\tconst data = await this.editor.save();\n\t\tdata.offer.name = this.nameInput.value;\n\t\t\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax.runAction('redsign:kompred.api.offer.save', { data: data })\n\t\t\t\t.then(resolve, reject);\n\t\t});\n\t}\n\n\tcopyClipboard()\n\t{\n\t\tthis.linkInput.focus();\n\t\tthis.linkInput.select(); \n\t\tdocument.execCommand('copy');\n\t\t\n\t\tif (window.toastr)\n\t\t{\n\t\t\twindow.toastr.success(BX.message('RS_KP_KOE_T_COPY_TO_CLIPBOARD_SUCCESS'));\n\t\t}\n\t}\n\n\tconfirmDelete(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tSwal.fire({\n\t\t\ttitle: BX.message('RS_KP_KOE_T_DELETE_CONFIRM'),\n\t\t\ttype: 'warning',\n\t\t\tshowCancelButton: true,\n\t\t\tanimation: false,\n\t\t\tconfirmButtonText: BX.message('RS_KP_KOE_T_DELETE_CONFIRM_YES'),\n\t\t\tcancelButtonText:  BX.message('RS_KP_KOE_T_DELETE_CONFIRM_NO'),\n\t\t})\n\t\t.then((result) => {\n\t\t\tif (result.value)\n\t\t\t\twindow.location = this.deleteButton.href;\n\t\t})\n\t}\n\n\tasync toggleShortlink()\n\t{\n\t\tif (this.isShowedShortlink)\n\t\t{\n\t\t\tthis.linkInput.value = this.download;\n\t\t\tthis.isShowedShortlink = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.shortlink)\n\t\t\t\tawait this.makeShortLink();\n\n\t\t\tthis.linkInput.value = this.shortlink;\n\t\t\tthis.isShowedShortlink = true;\n\t\t}\n\t}\n\n\tasync makeShortLink()\n\t{\n\t\tthis.shortLinkToggle.disabled = true;\n\t\tthis.shortLinkToggle.classList.add('disabled');\n\n\t\ttry\n\t\t{\n\t\t\tconst result = await new Promise((resolve, reject) => {\n\t\t\t\tBX.ajax.runComponentAction(\n\t\t\t\t\t'redsign:kompred.offer.edit', \n\t\t\t\t\t'makeShortLink', \n\t\t\t\t\t{ \n\t\t\t\t\t\tmode: 'class',\n\t\t\t\t\t\tdata: { \n\t\t\t\t\t\t\tsignedParameters: this.signedParameters\n\t\t\t\t\t\t} \n\t\t\t\t\t}\n\t\t\t\t).then(resolve, reject);\n\t\t\t});\n\n\t\t\tif (result.status === 'success' && result.data)\n\t\t\t{\n\t\t\t\tthis.shortlink = `${window.location.protocol}//${window.location.host}${result.data}`;\n\t\t\t}\n\t\t}\n\t\tcatch(e)\n\t\t{\n\t\t\tconsole.error(e);\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tthis.shortLinkToggle.disabled = false;\n\t\t\tthis.shortLinkToggle.classList.remove('disabled');\n\t\t}\n\t}\n}"],"names":["KPEdit","params","signedParameters","editor","nameInput","linkInput","copyToClipboardButton","deleteButton","shortLinkToggle","download","shortlink","isShowedShortlink","subscribe","RSKomPred","Editor","Events","CHANGED","saveData","bind","addEventListener","copyClipboard","confirmDelete","toggleShortlink","save","data","offer","name","value","Promise","resolve","reject","BX","ajax","runAction","then","focus","select","document","execCommand","window","toastr","success","message","event","preventDefault","Swal","fire","title","type","showCancelButton","animation","confirmButtonText","cancelButtonText","result","location","href","makeShortLink","disabled","classList","add","runComponentAction","mode","status","protocol","host","console","error","remove"],"mappings":"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"}