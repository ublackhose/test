{"version":3,"file":"component.js","sources":["../src/component.js"],"sourcesContent":["export class Blocks\n{\n\tconstructor($el, columns = [])\n\t{\n\t\tthis.$el = $el;\n\t\tthis.columns = columns;\n\t\t\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tif (window.dragula)\n\t\t{\n\t\t\tthis.drake = dragula(\n\t\t\t\tthis.columns,\n\t\t\t\t{\n\t\t\t\t\tmoves(el, container, handle) \n\t\t\t\t\t{\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\thandle.classList.contains('kt-portlet__head') || \n\t\t\t\t\t\t\t( handle.closest('.kt-portlet__head') && (!handle.classList.contains('btn') && !handle.closest('.btn')))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.drake.on('dragend', this.saveSorting.bind(this));\n\t\t}\n\n\t\tBX.addCustomEvent('SaleOrderDetailPaysystemChanged', () => this.reload('payment'));\n\n\t\t$(this.$el).find('.kt-portlet > .collapse').on('hidden.bs.collapse shown.bs.collapse', this.saveCollapsed.bind(this));\n\t}\n\n\tasync reload(blockName)\n\t{\n\t\tconst blockNode = this.$el.querySelector('[data-block=\"' + blockName + '\"]');\n\t\t\n\t\tif (blockNode)\n\t\t{\n\t\t\tconst url = window.location.href;\n\t\t\tKTApp.block(blockNode);\n\t\t\t\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst result = await this.sendRequest(url, {'reload_block': blockName});\n\t\t\t\tconst processed = BX.processHTML(result);\n\t\t\t\t\n\t\t\t\tconst contentNode = blockNode.querySelector('.kt-portlet__body');\n\t\t\t\tif (contentNode)\n\t\t\t\t{\n\t\t\t\t\tcontentNode.innerHTML =  processed.HTML;\n\t\t\t\t\tBX.ajax.processScripts(processed.SCRIPT);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch(e)\n\t\t\t{\n\t\t\t\tconsole.warn(e);\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tKTApp.unblock(blockNode);\n\t\t\t}\n\t\t}\n\t}\n\n\tsendRequest(url, data = {}, params = {})\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax({\n\t\t\t\tmethod: params.method || 'POST',\n\t\t\t\tdataType: params.dataType || 'html',\n\t\t\t\turl: url,\n\t\t\t\tdata: data,\n\t\t\t\tprocessData: false,\n\t\t\t\tonsuccess: resolve,\n\t\t\t\tonfailure: reject\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPositions()\n\t{\n\t\treturn this.columns.map(column => {\n\t\t\treturn Object.values(column.children).map(el => el.getAttribute('data-block'));\n\t\t});\n\t}\n\n\tgetCollapsed()\n\t{\n\t\treturn (\n\t\t\tObject\n\t\t\t\t.values(this.$el.querySelectorAll('.kt-portlet > .collapse'))\n\t\t\t\t.filter(el => !el.classList.contains('show'))\n\t\t\t\t.map(el => el.closest('[data-block]').getAttribute('data-block'))\n\t\t);\n\t}\n\n\tasync saveSorting()\n\t{\n\t\tconst sorting = this.getPositions();\n\n\t\ttry\n\t\t{\n\t\t\tawait BX.ajax.runAction(\n\t\t\t\t'redsign:b2bportal.api.userSettings.set', \n\t\t\t\t{ data: { key: 'sod_sorted_blocks', value: sorting } }\n\t\t\t);\n\t\t}\n\t\tcatch(e)\n\t\t{\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n\n\tasync saveCollapsed()\n\t{\n\t\tconst collapsed = this.getCollapsed();\n\n\t\ttry\n\t\t{\n\t\t\tawait BX.ajax.runAction(\n\t\t\t\t'redsign:b2bportal.api.userSettings.set', \n\t\t\t\t{ data: { key: 'sod_collapsed_blocks', value: collapsed } }\n\t\t\t);\n\t\t}\n\t\tcatch(e)\n\t\t{\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n}"],"names":["Blocks","$el","columns","init","window","dragula","drake","moves","el","container","handle","classList","contains","closest","on","saveSorting","bind","BX","addCustomEvent","reload","$","find","saveCollapsed","blockName","blockNode","querySelector","url","location","href","KTApp","block","sendRequest","result","processed","processHTML","contentNode","innerHTML","HTML","ajax","processScripts","SCRIPT","console","warn","unblock","data","params","Promise","resolve","reject","method","dataType","processData","onsuccess","onfailure","map","column","Object","values","children","getAttribute","querySelectorAll","filter","sorting","getPositions","runAction","key","value","collapsed","getCollapsed"],"mappings":"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"}